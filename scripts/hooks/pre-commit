#!/bin/bash

# Check if any files in the docs directory are staged for commit
DOCS_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "^docs/")

# If there are docs files modified, run the build script
if [ -n "$DOCS_FILES" ]; then
  echo "Docs files modified, rebuilding documentation..."
  
  # Store the current staged changes
  git stash push -q --keep-index
  
  # Run the docs build script
  ./docs/build.sh
  
  # Check if build was successful
  if [ $? -ne 0 ]; then
    echo "Error: Documentation build failed!"
    # Restore the stashed changes
    git stash pop -q
    exit 1
  fi
  
  # Add the generated files to the commit
  git add docs/public/
  
  # Restore the stashed changes
  git stash pop -q
  
  echo "Documentation rebuilt successfully."
fi

# Also check for content directory changes
CONTENT_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep "^content/")

# If there are content files modified, run the build script
if [ -n "$CONTENT_FILES" ]; then
  echo "Content files modified, rebuilding documentation..."
  
  # Store the current staged changes
  git stash push -q --keep-index
  
  # Run the docs build script
  ./docs/build.sh
  
  # Check if build was successful
  if [ $? -ne 0 ]; then
    echo "Error: Documentation build failed!"
    # Restore the stashed changes
    git stash pop -q
    exit 1
  fi
  
  # Add the generated files to the commit
  git add docs/public/
  
  # Restore the stashed changes
  git stash pop -q
  
  echo "Documentation rebuilt successfully."
fi

exit 0 