<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Nginx Configuration
  #

NewsFeed uses Nginx as a reverse proxy to route requests to the appropriate services and to serve static content. This page documents the Nginx configuration and optimizations.

  Multi-Stage Docker Build
  #

The Nginx service uses a multi-stage Docker build to optimize the image size and build process:

Documentation Build Stage: Builds the Hugo documentation
Nginx Base Stage: Sets up the base Nginx configuration
Production Stage: Creates the final optimized image

# ---- Hugo Documentation Build Stage ----
FROM ghcr.io/gohugoio/hugo:v0.147.8 AS docs-builder
# ... builds the documentation

# ---- Nginx Base Stage ----
FROM nginx:stable-alpine AS nginx-base
# ... installs dependencies

# ---- Production Stage ----
FROM nginx-base AS production
# ... creates the final image

  Nginx Configuration
  #

The Nginx configuration is structured to efficiently route requests and serve static content:"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="/docs/docs/deployment/nginx-configuration/"><meta property="og:site_name" content="NewsFeed Documentation"><meta property="og:title" content="Nginx Configuration"><meta property="og:description" content="Nginx Configuration # NewsFeed uses Nginx as a reverse proxy to route requests to the appropriate services and to serve static content. This page documents the Nginx configuration and optimizations.
Multi-Stage Docker Build # The Nginx service uses a multi-stage Docker build to optimize the image size and build process:
Documentation Build Stage: Builds the Hugo documentation Nginx Base Stage: Sets up the base Nginx configuration Production Stage: Creates the final optimized image # ---- Hugo Documentation Build Stage ---- FROM ghcr.io/gohugoio/hugo:v0.147.8 AS docs-builder # ... builds the documentation # ---- Nginx Base Stage ---- FROM nginx:stable-alpine AS nginx-base # ... installs dependencies # ---- Production Stage ---- FROM nginx-base AS production # ... creates the final image Nginx Configuration # The Nginx configuration is structured to efficiently route requests and serve static content:"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Nginx Configuration | NewsFeed Documentation</title><link rel=icon href=/docs/favicon.png><link rel=manifest href=/docs/manifest.json><link rel=canonical href=/docs/docs/deployment/nginx-configuration/><link rel=stylesheet href=/docs/book.min.27c601ff251cc5c9796bb272aace960013cf351d0c28a7e1301487b32d4800ee.css><script defer src=/docs/fuse.min.js></script><script defer src=/docs/en.search.min.50f06386365de8f89d841b8d0b503999b6a546355a068584d4f6d56087201672.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/docs/><img src=/docs/logo.png alt=Logo class=book-icon><span>NewsFeed Documentation</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-1bd881b6f3674bdbe6a5832f365e2cc1 class=toggle>
<label for=section-1bd881b6f3674bdbe6a5832f365e2cc1 class=flex><a href=/docs/docs/frontend/ class=flex-auto>Frontend Usage Guide</a></label><ul></ul></li><li><input type=checkbox id=section-e2abcc6bc653a4ad229e66aa778ea8ce class=toggle>
<label for=section-e2abcc6bc653a4ad229e66aa778ea8ce class=flex><a href=/docs/docs/admin/ class=flex-auto>Admin Dashboard Guide</a></label><ul></ul></li><li><input type=checkbox id=section-89295e3ad87cd739e9ae7938c36f5572 class=toggle>
<label for=section-89295e3ad87cd739e9ae7938c36f5572 class=flex><a href=/docs/docs/backend/ class=flex-auto>Backend API Documentation</a></label><ul></ul></li><li><input type=checkbox id=section-193dd47a9b08cf6c33639b07114fafa0 class=toggle>
<label for=section-193dd47a9b08cf6c33639b07114fafa0 class=flex><a href=/docs/docs/worker/ class=flex-auto>Worker Tasks</a></label><ul></ul></li><li><input type=checkbox id=section-ded1921c1a8aa8969511130d8fba8cc0 class=toggle>
<label for=section-ded1921c1a8aa8969511130d8fba8cc0 class=flex><a href=/docs/docs/authentication/ class=flex-auto>Authentication</a></label><ul></ul></li><li><input type=checkbox id=section-83334284bc70767f5442a76139afa498 class=toggle checked>
<label for=section-83334284bc70767f5442a76139afa498 class=flex><a href=/docs/docs/deployment/ class=flex-auto>Deployment Guides</a></label><ul><li><a href=/docs/docs/deployment/docker-optimizations/>Docker Optimizations</a></li><li><a href=/docs/docs/deployment/runtime-environment/>Frontend Environment Variables</a></li><li><a href=/docs/docs/deployment/backend-environment/>Backend Environment Variables</a></li><li><a href=/docs/docs/deployment/nginx-configuration/ class=active>Nginx Configuration</a></li><li><a href=/docs/docs/deployment/ci-cd/>Continuous Integration and Deployment</a></li><li><a href=/docs/docs/deployment/git-hooks/>Git Hooks</a></li></ul></li><li><input type=checkbox id=section-f665c998950cb6dbc3aa497165a99b48 class=toggle>
<label for=section-f665c998950cb6dbc3aa497165a99b48 class=flex><a href=/docs/docs/platforms/ class=flex-auto>Platform-Specific Guides</a></label><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/docs/svg/menu.svg class=book-icon alt=Menu></label><h3>Nginx Configuration</h3><label for=toc-control><img src=/docs/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#multi-stage-docker-build>Multi-Stage Docker Build</a></li><li><a href=#nginx-configuration-1>Nginx Configuration</a><ul><li><a href=#worker-configuration>Worker Configuration</a></li><li><a href=#http-configuration>HTTP Configuration</a></li><li><a href=#upstream-configuration>Upstream Configuration</a></li><li><a href=#server-configuration>Server Configuration</a></li></ul></li><li><a href=#performance-optimizations>Performance Optimizations</a><ul><li><a href=#gzip-compression>Gzip Compression</a></li><li><a href=#static-file-caching>Static File Caching</a></li><li><a href=#tcp-optimizations>TCP Optimizations</a></li><li><a href=#connection-handling>Connection Handling</a></li></ul></li><li><a href=#security-enhancements>Security Enhancements</a><ul><li><a href=#non-root-user>Non-Root User</a></li><li><a href=#security-headers>Security Headers</a></li></ul></li><li><a href=#health-checks>Health Checks</a></li><li><a href=#docker-compose-integration>Docker Compose Integration</a></li><li><a href=#customizing-the-configuration>Customizing the Configuration</a></li><li><a href=#best-practices>Best Practices</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=nginx-configuration>Nginx Configuration
<a class=anchor href=#nginx-configuration>#</a></h1><p>NewsFeed uses Nginx as a reverse proxy to route requests to the appropriate services and to serve static content. This page documents the Nginx configuration and optimizations.</p><h2 id=multi-stage-docker-build>Multi-Stage Docker Build
<a class=anchor href=#multi-stage-docker-build>#</a></h2><p>The Nginx service uses a multi-stage Docker build to optimize the image size and build process:</p><ol><li><strong>Documentation Build Stage</strong>: Builds the Hugo documentation</li><li><strong>Nginx Base Stage</strong>: Sets up the base Nginx configuration</li><li><strong>Production Stage</strong>: Creates the final optimized image</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># ---- Hugo Documentation Build Stage ----</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> ghcr.io/gohugoio/hugo:v0.147.8 AS docs-builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ... builds the documentation</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ---- Nginx Base Stage ----</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx:stable-alpine AS nginx-base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ... installs dependencies</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ---- Production Stage ----</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> nginx-base AS production</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># ... creates the final image</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h2 id=nginx-configuration-1>Nginx Configuration
<a class=anchor href=#nginx-configuration-1>#</a></h2><p>The Nginx configuration is structured to efficiently route requests and serve static content:</p><h3 id=worker-configuration>Worker Configuration
<a class=anchor href=#worker-configuration>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>user</span>  <span style=color:#e6db74>nginx</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>worker_processes</span>  <span style=color:#e6db74>auto</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>worker_rlimit_nofile</span> <span style=color:#ae81ff>65535</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>events</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>worker_connections</span>  <span style=color:#ae81ff>4096</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>worker_processes auto</code>: Automatically sets the number of worker processes based on CPU cores</li><li><code>worker_rlimit_nofile 65535</code>: Increases the file descriptor limit</li><li><code>worker_connections 4096</code>: Increases the maximum number of simultaneous connections</li></ul><h3 id=http-configuration>HTTP Configuration
<a class=anchor href=#http-configuration>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>http</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>include</span>       <span style=color:#e6db74>/etc/nginx/mime.types</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>default_type</span>  <span style=color:#e6db74>application/octet-stream</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Security headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Content-Type-Options</span> <span style=color:#e6db74>&#34;nosniff&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Frame-Options</span> <span style=color:#e6db74>&#34;SAMEORIGIN&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-XSS-Protection</span> <span style=color:#e6db74>&#34;1</span>; <span style=color:#f92672>mode=block&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Referrer-Policy</span> <span style=color:#e6db74>&#34;strict-origin-when-cross-origin&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Performance optimizations
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>sendfile</span>        <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>tcp_nopush</span>      <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>tcp_nodelay</span>     <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>keepalive_timeout</span>  <span style=color:#ae81ff>65</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>client_max_body_size</span> <span style=color:#e6db74>10M</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_comp_level</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>gzip_types</span> <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/json</span> <span style=color:#e6db74>application/javascript</span> <span style=color:#e6db74>text/xml</span> <span style=color:#e6db74>application/xml</span> <span style=color:#e6db74>application/xml+rss</span> <span style=color:#e6db74>text/javascript</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=upstream-configuration>Upstream Configuration
<a class=anchor href=#upstream-configuration>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#75715e># Upstream for backend
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>upstream</span> <span style=color:#e6db74>backend</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> backend:<span style=color:#ae81ff>8001</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Upstream for frontend app
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>upstream</span> <span style=color:#e6db74>frontend</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span> frontend:<span style=color:#ae81ff>3000</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=server-configuration>Server Configuration
<a class=anchor href=#server-configuration>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>_</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Support for proxy headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>real_ip_header</span> <span style=color:#e6db74>X-Forwarded-For</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>set_real_ip_from</span> 0.0.0.0<span style=color:#e6db74>/0</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Serve documentation
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/docs/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>alias</span> <span style=color:#e6db74>/docs/public/</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri $uri/ <span style=color:#e6db74>/docs/index.html</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Cache-Control</span> <span style=color:#e6db74>&#34;public,</span> <span style=color:#e6db74>max-age=3600&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Serve thumbnails as static files
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/thumbnails/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>alias</span> <span style=color:#e6db74>/thumbnails/</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Cache-Control</span> <span style=color:#e6db74>&#34;public,</span> <span style=color:#e6db74>max-age=86400&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>try_files</span> $uri =<span style=color:#ae81ff>404</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Proxy /api to backend
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/api/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span>         <span style=color:#e6db74>http://backend/api/</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># ... proxy headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Proxy everything else to frontend
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span>         <span style=color:#e6db74>http://frontend/</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e># ... proxy headers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=performance-optimizations>Performance Optimizations
<a class=anchor href=#performance-optimizations>#</a></h2><p>The Nginx configuration includes several performance optimizations:</p><h3 id=gzip-compression>Gzip Compression
<a class=anchor href=#gzip-compression>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>gzip</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>gzip_comp_level</span> <span style=color:#ae81ff>6</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>gzip_types</span> <span style=color:#e6db74>text/plain</span> <span style=color:#e6db74>text/css</span> <span style=color:#e6db74>application/json</span> <span style=color:#e6db74>application/javascript</span> <span style=color:#e6db74>text/xml</span> <span style=color:#e6db74>application/xml</span> <span style=color:#e6db74>application/xml+rss</span> <span style=color:#e6db74>text/javascript</span>;
</span></span></code></pre></div><p>This reduces the size of transmitted data, improving load times.</p><h3 id=static-file-caching>Static File Caching
<a class=anchor href=#static-file-caching>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>/docs/</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Cache-Control</span> <span style=color:#e6db74>&#34;public,</span> <span style=color:#e6db74>max-age=3600&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>location</span> <span style=color:#e6db74>/thumbnails/</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Cache-Control</span> <span style=color:#e6db74>&#34;public,</span> <span style=color:#e6db74>max-age=86400&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Caching static files reduces server load and improves client performance.</p><h3 id=tcp-optimizations>TCP Optimizations
<a class=anchor href=#tcp-optimizations>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>sendfile</span>        <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>tcp_nopush</span>      <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>tcp_nodelay</span>     <span style=color:#66d9ef>on</span>;
</span></span></code></pre></div><p>These settings optimize TCP packet handling for better performance.</p><h3 id=connection-handling>Connection Handling
<a class=anchor href=#connection-handling>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>keepalive_timeout</span>  <span style=color:#ae81ff>65</span>;
</span></span></code></pre></div><p>Keeps connections open for 65 seconds, reducing the overhead of establishing new connections.</p><h2 id=security-enhancements>Security Enhancements
<a class=anchor href=#security-enhancements>#</a></h2><h3 id=non-root-user>Non-Root User
<a class=anchor href=#non-root-user>#</a></h3><p>The Nginx service runs as a non-root user for improved security:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#75715e># Create non-root user for nginx</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> addgroup -g <span style=color:#ae81ff>101</span> -S nginx <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    adduser -S -D -H -u <span style=color:#ae81ff>101</span> -h /var/cache/nginx -s /sbin/nologin -G nginx -g nginx nginx<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Use non-root user</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>USER</span><span style=color:#e6db74> nginx</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=security-headers>Security Headers
<a class=anchor href=#security-headers>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>add_header</span> <span style=color:#e6db74>X-Content-Type-Options</span> <span style=color:#e6db74>&#34;nosniff&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>add_header</span> <span style=color:#e6db74>X-Frame-Options</span> <span style=color:#e6db74>&#34;SAMEORIGIN&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>add_header</span> <span style=color:#e6db74>X-XSS-Protection</span> <span style=color:#e6db74>&#34;1</span>; <span style=color:#66d9ef>mode=block&#34;</span> <span style=color:#e6db74>always</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>add_header</span> <span style=color:#e6db74>Referrer-Policy</span> <span style=color:#e6db74>&#34;strict-origin-when-cross-origin&#34;</span> <span style=color:#e6db74>always</span>;
</span></span></code></pre></div><p>These headers protect against common web vulnerabilities.</p><h2 id=health-checks>Health Checks
<a class=anchor href=#health-checks>#</a></h2><p>The Nginx service includes a health check to ensure it&rsquo;s functioning correctly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>HEALTHCHECK --interval=30s --timeout=5s </span>--start-period<span style=color:#f92672>=</span>5s --retries<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    CMD curl -f http://localhost/docs/ <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>This checks if the documentation is being served correctly every 30 seconds.</p><h2 id=docker-compose-integration>Docker Compose Integration
<a class=anchor href=#docker-compose-integration>#</a></h2><p>The <code>docker-compose.yml</code> file is configured to build and run the Nginx service:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>nginx</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>image</span>: <span style=color:#ae81ff>beardedtek/newsfeed-nginx:latest</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>nginx/Dockerfile</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>target</span>: <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;8880:80&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>thumbnails:/thumbnails:ro</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>healthcheck</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>test</span>: [<span style=color:#e6db74>&#34;CMD&#34;</span>, <span style=color:#e6db74>&#34;curl&#34;</span>, <span style=color:#e6db74>&#34;-f&#34;</span>, <span style=color:#e6db74>&#34;http://localhost/docs/&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>30s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>retries</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>start_period</span>: <span style=color:#ae81ff>10s</span>
</span></span></code></pre></div><h2 id=customizing-the-configuration>Customizing the Configuration
<a class=anchor href=#customizing-the-configuration>#</a></h2><p>To customize the Nginx configuration:</p><ol><li>Edit the <code>nginx/proxy.conf</code> file</li><li>Rebuild the Nginx image:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose build nginx
</span></span></code></pre></div></li><li>Restart the service:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose restart nginx
</span></span></code></pre></div></li></ol><h2 id=best-practices>Best Practices
<a class=anchor href=#best-practices>#</a></h2><ul><li>Regularly update the Nginx base image for security patches</li><li>Monitor Nginx logs for errors or performance issues</li><li>Adjust worker connections and processes based on server resources</li><li>Consider adding rate limiting for production deployments</li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/beardedtek/newsfeed/edit/main/docs/content/docs/deployment/nginx-configuration.md target=_blank rel=noopener><img src=/docs/svg/edit.svg class=book-icon alt>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#multi-stage-docker-build>Multi-Stage Docker Build</a></li><li><a href=#nginx-configuration-1>Nginx Configuration</a><ul><li><a href=#worker-configuration>Worker Configuration</a></li><li><a href=#http-configuration>HTTP Configuration</a></li><li><a href=#upstream-configuration>Upstream Configuration</a></li><li><a href=#server-configuration>Server Configuration</a></li></ul></li><li><a href=#performance-optimizations>Performance Optimizations</a><ul><li><a href=#gzip-compression>Gzip Compression</a></li><li><a href=#static-file-caching>Static File Caching</a></li><li><a href=#tcp-optimizations>TCP Optimizations</a></li><li><a href=#connection-handling>Connection Handling</a></li></ul></li><li><a href=#security-enhancements>Security Enhancements</a><ul><li><a href=#non-root-user>Non-Root User</a></li><li><a href=#security-headers>Security Headers</a></li></ul></li><li><a href=#health-checks>Health Checks</a></li><li><a href=#docker-compose-integration>Docker Compose Integration</a></li><li><a href=#customizing-the-configuration>Customizing the Configuration</a></li><li><a href=#best-practices>Best Practices</a></li></ul></nav></div></aside></main></body></html>